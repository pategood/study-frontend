浏览器页面渲染流程

<!-- --------------------------------- -->

解析这三种文件(HTML/XHTML/SVG)后，会生成DOM树,
解析css样式表，生成CSS规则树

浏览器引擎会将 CSS Rule Tree 附着到DOM Tree 上，
并根据DOM Tree 和 CSS Rule Tree构造 Rendering Tree（渲染树）

解析position, overflow, z-index等等属性，计算每一个渲染树节点的位置和大小，此过程被称为reflow。最后调用操作系统的Native GUI API完成绘制（repain）。注意：

<!-- ---------------------------------- -->


脚本文件的defer和async属性

为了防止脚本加载使浏览器页面阻塞，妨碍用户体验。应该合理使用<script>标签的defer属性和async属性。这两个属性用于调整脚本的下载和执行顺序，使其不阻塞页面加载。

defer：开启新的线程下载脚本文件，并使脚本在文档解析完成后执行。

    defer只适用于外联脚本，如果script标签没有指定src属性，只是内联脚本，不要使用defer
    如果有多个声明了defer的脚本，则会按顺序下载和执行
    defer脚本会在DOMContentLoaded和load事件之前执行

async：异步下载脚本文件，下载完毕立即解释执行代码。 HTML5的新增属性。

    只适用于外联脚本，这一点和defer一致
    如果有多个声明async的脚本，其下载和执行都是异步的，不能确保彼此的先后顺序
    async会在load事件之前执行，但并不能确保与DOMContentLoaded的执行先后顺序








浏览器从HTTP服务器获取html文档，到呈现页面给用户，会经过以下几个步骤：

1、解析文档构建DOM树
浏览器的解析内容可以分为三个部分：

HTML/XHTML/SVG：解析这三种文件后，会生成DOM树（DOM Tree）
CSS：解析样式表，生成CSS规则树（CSS Rule Tree）
JavaScript：解析脚本，通过DOM API和CSSOM API操作DOM Tree和CSS Rule Tree，与用户进行交互。
以上三类文件的执行顺序会根据其在文档中的位置及其标签属性的不同而有异同，具体在后文进行讨论。

2、构建渲染树
解析文档完成后，浏览器引擎会将 CSS Rule Tree 附着到DOM Tree 上，
并根据DOM Tree 和 CSS Rule Tree构造 Rendering Tree（渲染树）。此处需要注意：

Render Tree和DOM Tree的区别在于，类似Head或display：node之类的东西不会放在渲染树中；
将CSS Rule Tree匹配到DOM Tree需要解析CSS的选择器，为了提高该过程的性能，DOM树应该尽量小，CSS Selector应该尽量使用id和class，避免过度层叠。

3、布局与绘制渲染树
解析position, overflow, z-index等等属性，计算每一个渲染树节点的位置和大小，
此过程被称为reflow。最后调用操作系统的Native GUI API完成绘制（repain）.注意：

渲染树的节点，在Gecko中称为frame，而在webkit中称为renderer；
reflow和repaint是两个不同的概念，其区别会在后文进行探讨。
脚本和样式文件对页面渲染的影响
浏览器从服务器获取文档并从上到下进行解析，在脚本文件标签不包含defer和async属性的情况下，会按照如下规则执行文档内容：

解析html文档，遇到HTML标签时，构建DOM树
在构建DOM的过程中，如果遇到外联的样式声明或脚本声明，则暂停文档解析，创建新的网络连接，开始下载样式文件和脚本文件
样式文件下载完成后，构建CSS Rule DOM，脚本文件下载完成后，解释并立即执行。
构建DOM的同时，结合CSS规则树完成页面渲染。
如果DOM树先于CSS规则树构建完成，则在CSS规则树构建完成后，页面会发生一次重绘，将新构建的CSS规则应用于渲染树。